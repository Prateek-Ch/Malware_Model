import numpy as np
import keras
import tensorflow as tf
from keras.preprocessing.image import ImageDataGenerator
import sys 

Malware_model = tf.keras.models.load_model('models/malware_model.h5')

train_datagen = ImageDataGenerator(horizontal_flip = True)
training_set = train_datagen.flow_from_directory('malimg_paper_dataset_imgs',
                                                 target_size = (64, 64),
                                                 batch_size = 10000)


from keras.preprocessing import image
test_image = image.load_img('images/test-image.jpg', target_size = (64, 64))
test_image = image.img_to_array(test_image)
test_image = np.expand_dims(test_image, axis = 0)
result = Malware_model.predict(test_image)
result = np.argmax(result,axis = 1)
# print(result)

#Class name 
class_name = (training_set.class_indices)
class_name = dict((v,k) for k,v in class_name.items())
predictions = [class_name[k] for k in result]

import json
print("\n The detected malware is: ")
print(json.dumps(predictions))

Malware_model.input

sys.stdout.flush()
